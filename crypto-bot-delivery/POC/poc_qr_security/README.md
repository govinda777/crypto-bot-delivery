# POC 3: QR Code Security System

## Overview

This Proof of Concept (POC) demonstrates the generation and simulated scanning of QR codes for delivery confirmation, as implemented in the `delivery_qr` module. It focuses on the creation of QR codes containing essential order information and a unique token, and the subsequent decoding of these QR codes.

The security aspect demonstrated at this stage relies on the integrity of the data embedded (via JSON serialization) and the token-based validation approach, where a unique token within the QR code is intended to be verified by a backend system (like the API layer, which is not part of this specific POC's testable code).

## Key Components Demonstrated

*   **`delivery_qr.generator`**: Used to create QR code image files.
*   **`delivery_qr.scanner`**: Used to read QR code image files and decode their content.

## Prerequisites

*   **Python Environment:** Python 3.10+ with `pip`.
*   **Required Libraries:**
    *   `qrcode` (for QR generation)
    *   `Pillow` (PIL fork, a dependency for `qrcode` and for image manipulation)
    *   `pyzbar` (for QR decoding)
    *   `pytest` and `pytest-bdd` (for running automated tests)
    Navigate to the root of the `crypto-bot-delivery` project. It's recommended to use a virtual environment:
    ```bash
    python -m venv venv
    source venv/bin/activate  # On Windows: venv\Scripts\activate
    pip install qrcode Pillow pyzbar pytest pytest-bdd
    pip install -e . # Install crypto-bot-delivery in editable mode
    ```

## Demonstrations

### 1. Manual Generation and Inspection of QR Codes

You can manually run the example block within `src/delivery_qr/generator.py` to create sample QR codes.

1.  Navigate to the `src/delivery_qr/` directory:
    ```bash
    cd /path/to/crypto-bot-delivery/src/delivery_qr
    ```
2.  Run the generator script:
    ```bash
    python generator.py
    ```
3.  This will create a subdirectory (e.g., `output_qrs_generated_examples`) containing example QR code images like `pickup_qr_example.png` and `delivery_qr_example.png`.
4.  You can inspect these images with any standard QR code scanning app on your phone to see the JSON data they contain.

### 2. Manual "Scanning" (Decoding) of QR Codes

Similarly, you can run the example block within `src/delivery_qr/scanner.py` to decode the QR codes generated in the previous step.

1.  Ensure you have first run `python generator.py` as described above so that the example QR images exist.
2.  Navigate to the `src/delivery_qr/` directory:
    ```bash
    cd /path/to/crypto-bot-delivery/src/delivery_qr
    ```
3.  Run the scanner script:
    ```bash
    python scanner.py
    ```
4.  The script will attempt to scan the pre-generated QR codes and print the decoded data or any errors encountered.

## Running Automated Tests

The `delivery_qr` module comes with unit tests and Behavior-Driven Development (BDD) tests to ensure its functionality.

1.  **Navigate to Project Root:**
    Open your terminal and go to the root directory of the `crypto-bot-delivery` project.
    ```bash
    cd /path/to/crypto-bot-delivery
    ```
2.  **Activate Virtual Environment (if used):**
    ```bash
    source venv/bin/activate
    ```
3.  **Run `pytest`:**
    Execute `pytest`. It will automatically discover and run tests in the `src/delivery_qr/tests/` directory.
    ```bash
    pytest -v src/delivery_qr/tests/
    ```
    *   The `-v` flag provides verbose output.
    *   This will run both unit tests (from `test_generator.py` and `test_scanner.py`) and the BDD scenarios defined in `qr_confirmation.feature` (via `test_qr_confirmation_steps.py`).

## Security Notes from this POC

*   The QR codes generated by this module embed data including a `token`.
*   The core security assumption for this POC is that this `token` is unique and its validity would be checked by a trusted backend system against the `order_id` and `type` (pickup/delivery).
*   The `delivery_qr` module itself does not perform this final token validation; it only generates and decodes the QR. The BDD tests for "token mismatch" simulate this external validation by comparing the decoded token to an "expected" one defined in the test.
*   No cryptographic signing of the QR data itself is performed within this module in the current iteration.

This POC establishes the foundational capability to generate and interpret QR codes. The integration with a backend API and the blockchain for actual confirmation based on these QR codes would be the next step in a full implementation.
```
